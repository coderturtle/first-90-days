<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/first-90-days/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=first-90-days/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="Example of first 90 days reviewing an architecture thene">
<meta name="author" content="Derm Duncan">

    <link rel="icon" href="/first-90-days/images/favicon.png" type="image/png">

    <title>Update Bucket Policy :: Head of Architecture First 90 Days</title>

    
    <link href="/first-90-days/css/nucleus.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/fontawesome-all.min.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/hybrid.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/featherlight.min.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/perfect-scrollbar.min.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/auto-complete.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/atom-one-dark-reasonable.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/theme.css?1718569025" rel="stylesheet">
    <link href="/first-90-days/css/hugo-theme.css?1718569025" rel="stylesheet">
    
    <link href="/first-90-days/css/theme-blue.css?1718569025" rel="stylesheet">
    
    

    <script src="/first-90-days/js/jquery-3.3.1.min.js?1718569025"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/first-90-days/en/30to60/update-bucket-policy/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
  <img src="images/cloud-gremlin-blue.png" />
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/first-90-days/js/lunr.min.js?1718569025"></script>
<script type="text/javascript" src="/first-90-days/js/auto-complete.js?1718569025"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/localhost:1313\/first-90-days\/";
    
</script>
<script type="text/javascript" src="/first-90-days/js/search.js?1718569025"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/first-90-days/en/first30/" title="First 30 Days" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/first30/">
          <b>1. </b>First 30 Days
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/first30/s3/" title="S3" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/first30/s3/">
          <b>a. </b>S3
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/first30/cloudfront/" title="Cloudfront" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/first30/cloudfront/">
          <b>b. </b>Cloudfront
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/first30/security/" title="Security" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/first30/security/">
          <b>c. </b>Security
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/first30/all-together/" title="Putting it all together" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/first30/all-together/">
          <b>d. </b>Putting it all together
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/" title="Days 30 - 60" class="dd-item 
        parent
        
        
        ">
      <a href="/first-90-days/en/30to60/">
          <b>2. </b>Days 30 - 60
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/strategic-plan/" title="Strategic Plan" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/30to60/strategic-plan/">
          <b>a. </b>Strategic Plan
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/team-integration/" title="Team Integration" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/30to60/team-integration/">
          <b>b. </b>Team Integration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/quick-wins/" title="Quick Wins" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/30to60/quick-wins/">
          <b>c. </b>Quick Wins
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/update-bucket-policy/" title="Update Bucket Policy" class="dd-item 
        
        active
        
        ">
      <a href="/first-90-days/en/30to60/update-bucket-policy/">
          <b>e. </b>Update Bucket Policy
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/30to60/update-dns/" title="Update DNS entries" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/30to60/update-dns/">
          <b>f. </b>Update DNS entries
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/first-90-days/en/60to90/" title="Days 60 - 90" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/60to90/">
          <b>3. </b>Days 60 - 90
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/60to90/overview/" title="Solution Overview" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/60to90/overview/">
          <b>a. </b>Solution Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/60to90/details/" title="Solution Details" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/60to90/details/">
          <b>b. </b>Solution Details
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/60to90/deploy/" title="Deploy Stack" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/60to90/deploy/">
          <b>c. </b>Deploy Stack
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/first-90-days/en/conclusion/" title="Summary &amp; Conclusions" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/conclusion/">
          <b>4. </b>Summary &amp; Conclusions
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/conclusion/overview/" title="Solution Overview" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/conclusion/overview/">
          <b>a. </b>Solution Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/conclusion/details/" title="Solution Details" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/conclusion/details/">
          <b>b. </b>Solution Details
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/first-90-days/en/conclusion/deploy/" title="Deploy Stack" class="dd-item 
        
        
        
        ">
      <a href="/first-90-days/en/conclusion/deploy/">
          <b>c. </b>Deploy Stack
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/coderturtle/first-90-days"><i class='fab fa-fw fa-github'></i> GitHub repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://coderturtle.githubpages.io/first-90-days"><i class='fas fa-fw fa-camera'></i> Showcases</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://gohugo.io/"><i class='fas fa-fw fa-bookmark'></i> Hugo Documentation</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <center>
    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download matcornic/hugo-theme-learn on GitHub">Download</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn" data-icon="octicon-star" data-show-count="true" aria-label="Star matcornic/hugo-theme-learn on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork matcornic/hugo-theme-learn on GitHub">Fork</a>

    <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/coderturtle/first-90-days30to60/update-bucket-policy/_index.en.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/first-90-days/en/'>Head of Architecture - First 90 Days</a> > <a href='/first-90-days/en/30to60/'>Days 30 - 60</a> > Update Bucket Policy
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#s3">S3</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Update Bucket Policy
            </h1>
          

        



	<h3 id="s3">S3</h3>
<ol>
<li>Sign in to the AWS Management Console and open the S3 console at <a href="https://console.aws.amazon.com/s3/">https://console.aws.amazon.com/s3/</a>.</li>
</ol>
<ul>
<li>Go to Permissions</li>
<li>Go to Bucket Policy</li>
</ul>

<div class="notices note" ><p>For S3 and Cloudfront there is slightly different configuration depending if you are using Origin Access Identifiers on a private bucket or are using the S3 static hosting feature on a public bucket.</p>
</div>

<h1 id="single-page-app">Single Page App</h1>
<ol start="2">
<li>If you walked through the previous CloudFront distibution setup and selected it to update the bucket policy you will have a policy that looks something like this</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;Version&#39;</span>: <span style="color:#e6db74">&#39;2008-10-17&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;Id&#39;</span>: <span style="color:#e6db74">&#39;PolicyForCloudFrontPrivateContent&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;Statement&#39;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Sid&#39;</span>: <span style="color:#e6db74">&#39;1&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Effect&#39;</span>: <span style="color:#e6db74">&#39;Allow&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Principal&#39;</span>:
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#39;AWS&#39;</span>: <span style="color:#e6db74">&#39;arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ORIGIN_ACCESS_ID&#39;</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Action&#39;</span>: <span style="color:#e6db74">&#39;s3:GetObject&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Resource&#39;</span>: <span style="color:#e6db74">&#39;arn:aws:s3:::BUCKET_NAME/*&#39;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The problem here is if an object does not exist in the bucket, even with the 404 error page redirect, you will see the error NoSuchKey. This is common for endpoints like /about. This is actually a known issue and is clearly defined in the <a href="https://aws.amazon.com/premiumsupport/knowledge-center/404-error-nosuchkey-s3/">knowledge center</a>. The fix is very simple but unless you understand how these policies work, you will miss this. You need to add the action s3:ListBucket. This sounds easy enough but what gets most people is that this works on a different resource than the s3:GetObject so simply adding the action will not work.</p>
<p>To fix this, update your policy to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;Version&#39;</span>: <span style="color:#e6db74">&#39;2008-10-17&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;Statement&#39;</span>:
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Sid&#39;</span>: <span style="color:#e6db74">&#39;AllowCloudFrontOriginAccess&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Effect&#39;</span>: <span style="color:#e6db74">&#39;Allow&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Principal&#39;</span>:
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#39;AWS&#39;</span>: <span style="color:#e6db74">&#39;arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ORIGIN_ACCESS_ID&#39;</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Action&#39;</span>: [<span style="color:#e6db74">&#39;s3:GetObject&#39;</span>, <span style="color:#e6db74">&#39;s3:ListBucket&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;Resource&#39;</span>: [<span style="color:#e6db74">&#39;arn:aws:s3:::BUCKET_NAME&#39;</span>, <span style="color:#e6db74">&#39;arn:aws:s3:::BUCKET_NAME/*&#39;</span>],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img alt="SPA Policy" src="images/s3-policy-spa.png?width=60pc"></p>
<h1 id="s3-hosted-site">S3 Hosted Site</h1>
<ol start="2">
<li>Make sure that public read is allowed on objects in the bucket.</li>
</ol>
<p><img alt="Public Policy" src="images/s3-policy.png?width=60pc"></p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/first-90-days/en/30to60/quick-wins/" title="Quick Wins"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/first-90-days/en/30to60/update-dns/" title="Update DNS entries" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/first-90-days/js/clipboard.min.js?1718569025"></script>
    <script src="/first-90-days/js/perfect-scrollbar.min.js?1718569025"></script>
    <script src="/first-90-days/js/perfect-scrollbar.jquery.min.js?1718569025"></script>
    <script src="/first-90-days/js/jquery.sticky.js?1718569025"></script>
    <script src="/first-90-days/js/featherlight.min.js?1718569025"></script>
    <script src="/first-90-days/js/highlight.pack.js?1718569025"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/first-90-days/js/modernizr.custom-3.6.0.js?1718569025"></script>
    <script src="/first-90-days/js/learn.js?1718569025"></script>
    <script src="/first-90-days/js/hugo-learn.js?1718569025"></script>
    
        
            <script src="/first-90-days/mermaid/mermaid.js?1718569025"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105947713-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
